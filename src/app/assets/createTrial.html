<script>
    function postForm() {
        var url = 'https://api.gritvirtual.info/account';
        var xhr = new XMLHttpRequest();
        var form = document.getElementById('freeTrialForm');
        var spinner = document.getElementsByClassName('ajax-loader')[0];
        var output = document.getElementsByClassName('wpcf7-response-output')[0];
        
        // ONLY DEV
        var env = document.getElementById('env');
        url = env.value + '/account';
        //

        var firstNameError = document.getElementById('firstNameError');
        var lastNameError = document.getElementById('lastNameError');
        var nameError = document.getElementById('nameError');
        var emailError = document.getElementById('emailError');
        firstNameError.innerHTML = '';
        lastNameError.innerHTML = '';
        nameError.innerHTML = '';
        emailError.innerHTML = '';

        spinner.classList.add('is-active');
        if (document.body.classList.contains('wpcf7-validation-errors')) output.classList.remove('wpcf7-validation-errors');
        if (document.body.classList.contains('wpcf7-mail-sent-ok')) output.classList.remove('wpcf7-mail-sent-ok');
        if (!document.body.classList.contains('wpcf7-display-none')) output.classList.add('wpcf7-display-none');

        var json = {'timeZone': Intl.DateTimeFormat().resolvedOptions().timeZone};
        for (var i = 0; i < form.elements.length; i++) {
            if (form.elements[i].type !== 'button') json[form.elements[i].id] = form.elements[i].value;
        }

        let formValid = true;
        if (json.firstName === '') {
            formValid = false;
            firstNameError.innerHTML = 'The field is required.';
        }
        if (json.lastName === '') {
            formValid = false;
            lastNameError.innerHTML = 'The field is required.';
        }
        if (json.name === '') {
            formValid = false;
            nameError.innerHTML = 'The field is required.';
        }
        if (json.email === '') {
            formValid = false;
            emailError.innerHTML = 'The field is required.';
        }
        const regEx = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        if (json.email !== '' && !regEx.test(json.email)) {
            formValid = false;
            emailError.innerHTML = 'The email is invalid.';
        }

        if (!formValid) {
            spinner.classList.remove('is-active');
            return;
        }

        xhr.open("POST", url);
        xhr.setRequestHeader("Content-type", "application/json");

        xhr.onloadend = function () {
            if (xhr.status === 409) {
                emailError.innerHTML = 'This email is already registered.';
            } else if (xhr.status === 200) {
                output.classList.remove('wpcf7-display-none');
                output.classList.add('wpcf7-mail-sent-ok');
                output.innerHTML = 'Success! Please check your email to get started.';
                for (var i = 0; i < form.elements.length; i++) {
                    if (form.elements[i].type !== 'button') form.elements[i].value = '';
                }
            } else {
                output.classList.remove('wpcf7-display-none');
                output.classList.add('wpcf7-validation-errors');
                output.innerHTML = 'There was an error. Please contact us to setup your trial.';
            }
            spinner.classList.remove('is-active');
        }

        xhr.send(JSON.stringify(json));
    }
</script>

<div class="elementor-contact-form-7 jet-elements"></div>
    <div role="form" class="wpcf7">
        <div class="screen-reader-response"></div>
        <form action="javascript.void(0)" class="wpcf7-form" novalidate="novalidate" id="freeTrialForm">

            <!--DEV ONLY, remove for prod-->
            <p>
                <span class="wpcf7-form-control-wrap text-109">
                    <select id="env">
                        <option value="https://api.gritvirtual.info" selected>Dev</option>
                        <option value="http://localhost:8080">Local</option>
                        <option value="https://api.gritvirtual.xyz">Staging</option>
                    </select>
                </span>
            </p>
            <!---->

            <p>
                <span class="wpcf7-form-control-wrap text-109">
                    <input type="text" id="firstName" value="" size="40" class="wpcf7-form-control wpcf7-text wpcf7-validates-as-required" aria-required="true"
                        aria-invalid="false" placeholder="First Name *">
                    <span id="firstNameError" role="alert" class="wpcf7-not-valid-tip"></span>
                </span>
            </p>

            <p>
                <span class="wpcf7-form-control-wrap text-109">
                    <input type="text" id="lastName" value="" size="40" class="wpcf7-form-control wpcf7-text wpcf7-validates-as-required" aria-required="true"
                        aria-invalid="false" placeholder="Last Name *">
                    <span id="lastNameError" role="alert" class="wpcf7-not-valid-tip"></span>
                </span>
            </p>

            <p>
                <span class="wpcf7-form-control-wrap text-109">
                    <input type="text" id="name" value="" size="40" class="wpcf7-form-control wpcf7-text wpcf7-validates-as-required" aria-required="true"
                        aria-invalid="false" placeholder="Company Name *">
                    <span id="nameError" role="alert" class="wpcf7-not-valid-tip"></span>
                </span>
            </p>

            <p>
                <span class="wpcf7-form-control-wrap email-684">
                    <input type="email" id="email" value="" size="40" class="wpcf7-form-control wpcf7-text wpcf7-email wpcf7-validates-as-required wpcf7-validates-as-email"
                        aria-required="true" aria-invalid="false" placeholder="E-mail *">
                    <span id="emailError" role="alert" class="wpcf7-not-valid-tip"></span>
                </span>
            </p>

            <p>
                <input type="button" value="Sign Up" class="wpcf7-form-control wpcf7-submit" onclick="postForm()">
                <span id="freeTrialFormLoader" class="ajax-loader"></span>
            </p>
            <div class="wpcf7-response-output wpcf7-display-none"></div>
        </form>
    </div>
</div>